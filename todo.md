# 戦国時代ゲーム 実装進捗管理

## 現在のフェーズ: フェーズ5完了 - 完全なイベントシステム実装済み

### フェーズ1: 基盤構築 ✓ 完了
- [x] プロジェクト構造のセットアップ
- [x] requirements.txtの作成
- [x] config.pyの作成（全定数定義）
- [x] データモデルの実装
  - [x] models/province.py
  - [x] models/daimyo.py
  - [x] models/general.py
  - [x] models/army.py
  - [x] models/diplomacy.py
- [x] JSONデータファイルの作成
  - [x] data/provinces.json (15領地)
  - [x] data/daimyo.json (6大名)
  - [x] data/generals.json (15武将)
- [x] core/game_state.pyの実装
- [x] main.pyの基本実装（pygameウィンドウとループ）
- [x] テスト: データ読込と画面表示

**成果物:** ゲームがデータを読み込み、基本情報を画面に表示できる

### フェーズ2: ターンシステムと経済 ✓ 完了
- [x] core/turn_manager.pyの実装
- [x] systems/economy.pyの実装
- [x] systems/internal_affairs.pyの実装
- [x] ui/widgets.pyの実装
- [x] main.pyへの統合（マップ画面、領地詳細画面）
- [x] テスト: 経済コマンドを含むターンサイクル

**成果物:** 内政コマンドを実行し、ターンを進行できるプレイ可能なゲーム

### フェーズ3: 軍事と戦闘 ✓ 完了
- [x] systems/military.pyの実装
- [x] systems/combat.pyの実装
- [x] 軍事コマンドUIの実装（徴兵、攻撃）
- [x] 攻撃対象選択画面の実装
- [x] 自動戦闘システムの実装
- [x] 領地占領メカニクスの実装
- [x] 戦闘フローの統合

**成果物:** 徴兵・攻撃コマンドが機能し、ターン終了時に戦闘が自動解決されるシステム

### フェーズ4: 外交とAI ✓ 完了
- [x] systems/diplomacy.pyの実装
- [x] DiplomaticRelationモデルの拡張（RelationType追加）
- [x] systems/ai.pyの実装（基本的なAI）
- [x] AIターン実行フェーズの統合
- [x] 外交更新フェーズの統合
- [x] AI戦闘キューイングの実装
- [x] AI攻撃性の調整（積極的に攻撃）
- [x] 加齢システムの改善（全大名が老化・死去）
- [x] メッセージログの詳細化（戦闘結果、収支情報）
- [x] メッセージログのスクロール機能

**成果物:** AIが自律的に内政・軍事・外交を実行し、プレイヤーと競争するシステム

### フェーズ5: イベントシステムと演出強化 ✓ 完了

#### Phase 5A: 基本イベントシステム ✓ 完了
- [x] models/event.pyの作成
  - [x] EventType enum（5種類）
  - [x] GameEventクラス
  - [x] EventChoiceクラス
- [x] systems/events.pyの実装
  - [x] JSONからのイベント読み込み
  - [x] ターンごとのイベント発生判定
  - [x] 季節・地形・条件チェック
  - [x] イベント効果の適用
  - [x] 治水レベルによる被害軽減
  - [x] イベント履歴の記録
- [x] turn_manager.pyのPhase 4有効化
  - [x] _phase_4_random_events()の実装
  - [x] pending_event_choicesの追加
- [x] 動作確認（洪水・豊作・疫病）

#### Phase 5B: イベントデータ拡充 ✓ 完了
- [x] data/events.jsonの作成（18種類）
- [x] 自然災害イベント（5種）
  - [x] 洪水（夏・5%、治水で軽減）
  - [x] 干ばつ（夏秋・3%）
  - [x] 地震（全季節・2%）
  - [x] 台風（夏秋・4%）
  - [x] 疫病（全季節・3%）
- [x] 経済イベント（6種）
  - [x] 豊作（秋・10%）
  - [x] 凶作（秋・5%）
  - [x] 商業繁栄（町Lv3以上・5%）
  - [x] 人口増加（忠誠度80以上・7%）
  - [x] 税収増加（町Lv2以上・6%）
  - [x] 物価上昇（全季節・4%）
- [x] 社会イベント（3種）
  - [x] 一揆（忠誠度30以下・選択肢あり）
  - [x] 豪族の協力（忠誠度70以上・5%）
  - [x] 治安悪化（兵士100以下・4%）
- [x] 軍事イベント（2種）
  - [x] 武将仕官（3%）
  - [x] 兵の士気向上（6%）
- [x] 外交イベント（2種）
  - [x] 他国からの贈物（2%）
  - [x] 国境紛争（3%）
- [x] バランス調整（発生頻度1～2個/ターン）

#### Phase 5C: UI実装 ✓ 完了
- [x] ui/event_dialog.pyの作成
  - [x] 和風デザイン（二重枠、半透明背景）
  - [x] イベント名・説明文・効果の表示
  - [x] 選択肢ボタン（最大2個）
  - [x] ESCキーで自動選択
- [x] main.pyへのダイアログ統合
  - [x] ターン終了後の自動表示
  - [x] 選択肢の効果適用
  - [x] メッセージログへの記録
  - [x] 複数イベントの連続表示対応

#### Phase 5D: イベント履歴画面 ✓ 完了
- [x] ui/event_history_screen.pyの作成
  - [x] 最新10件のイベント表示
  - [x] ターン・季節・イベント名・領地名表示
  - [x] スクロール機能（↑↓、PageUp/Down、マウスホイール）
  - [x] [H]キーで開く/[ESC]で閉じる
- [x] main.pyへの統合
  - [x] キーボードショートカット実装
  - [x] 操作説明の更新

**成果物:** 18種類の多様なイベントが発生し、選択肢ダイアログと履歴画面で管理できるシステム

### フェーズ6: 仕上げとPolish（未着手）
- [ ] グラフィック演出の追加
  - [ ] イベントダイアログへの画像追加
  - [ ] アニメーション効果
  - [ ] 戦闘シーンの演出強化
- [ ] core/save_load.pyの実装
  - [ ] ゲームデータのセーブ機能
  - [ ] ロード機能
  - [ ] オートセーブ
- [ ] メインメニューの実装
  - [ ] タイトル画面
  - [ ] 新規ゲーム/ロード選択
  - [ ] オプション設定
- [ ] エンディング画面の実装
  - [ ] 勝利画面
  - [ ] 敗北画面
  - [ ] 統計情報表示
- [ ] ui/status_screen.pyの実装
  - [ ] 全体マップビュー
  - [ ] 勢力ランキング
  - [ ] 統計情報

### フェーズ7: バランスとテスト（未着手）
- [ ] プレイテストとバランス調整
  - [ ] AI難易度調整
  - [ ] イベント発生確率の微調整
  - [ ] 経済バランス調整
- [ ] パフォーマンス最適化
  - [ ] 描画処理の最適化
  - [ ] メモリ使用量の削減
- [ ] バグ修正
- [ ] ドキュメント作成
  - [ ] README.md
  - [ ] プレイマニュアル
- [ ] シナリオバリエーション追加
  - [ ] 異なる開始年代
  - [ ] カスタム大名配置

## 実装済み機能一覧

### コアシステム
- ✓ 11フェーズターンシステム
- ✓ GameState（ゲーム状態管理）
- ✓ JSONデータ読み込み
- ✓ 季節・年の進行
- ✓ 加齢・死亡システム

### 経済システム
- ✓ 米生産（開発レベル依存）
- ✓ 税収（町レベル・税率依存）
- ✓ 兵士維持費
- ✓ 交易システム
- ✓ ローンシステム

### 内政システム
- ✓ 開墾（開発レベル向上）
- ✓ 町開発（町レベル向上）
- ✓ 治水（洪水被害軽減）
- ✓ 米配布（忠誠度向上）
- ✓ 税率調整

### 軍事システム
- ✓ 徴兵（農民→兵士変換）
- ✓ 訓練（士気向上）
- ✓ 部隊編成
- ✓ 攻撃コマンド
- ✓ 自動戦闘解決
- ✓ 領地占領

### 外交システム
- ✓ 同盟（ALLIANCE）
- ✓ 不可侵条約（NON_AGGRESSION）
- ✓ 宣戦布告（WAR）
- ✓ 贈り物（関係値向上）
- ✓ 条約期間管理

### AIシステム
- ✓ 内政AI（開墾、治水、徴兵、米配布）
- ✓ 軍事AI（攻撃判定、部隊編成）
- ✓ 外交AI（条約提案、贈り物）
- ✓ 優先度ベースの意思決定

### イベントシステム
- ✓ 18種類のランダムイベント
- ✓ 季節・地形・条件による発生制御
- ✓ 選択肢イベント（一揆）
- ✓ 治水による被害軽減
- ✓ イベント履歴記録
- ✓ イベント選択ダイアログ
- ✓ イベント履歴画面

### UIシステム
- ✓ メインマップ画面
- ✓ 領地詳細画面
- ✓ 攻撃対象選択画面
- ✓ メッセージログ（スクロール対応）
- ✓ イベント選択ダイアログ
- ✓ イベント履歴画面
- ✓ 日本語フォント対応（Meiryo）
- ✓ ボタン、パネル、プログレスバー

## 現在の作業

### 完了した内容（Phase 5まで）

**Phase 5: イベントシステムと演出強化**
- 18種類の多様なイベント実装完了
- イベント選択肢ダイアログ実装完了
- イベント履歴画面実装完了
- 発生頻度とバランス調整完了（1～2個/ターン）
- プレイヤーとAIで異なるイベント処理実装完了

### 次のステップ（フェーズ6以降）

**オプション1: グラフィック演出の追加**
- イベントダイアログへの画像追加
- アニメーション効果
- 戦闘演出の強化

**オプション2: セーブ/ロード機能**
- ゲーム状態の保存
- ロード機能
- オートセーブ

**オプション3: メニュー画面**
- タイトル画面
- ゲーム開始/ロード
- エンディング画面

**オプション4: バランス調整とテスト**
- プレイテスト
- AI難易度調整
- バグ修正

## 技術スタック
- Python 3.10+
- pygame 2.6.1
- JSON（データファイル）

## プロジェクト構成
```
nobunaga/
├── main.py                 # メインゲームループ
├── config.py              # 全定数定義
├── requirements.txt       # 依存パッケージ
├── core/
│   ├── game_state.py     # ゲーム状態管理
│   └── turn_manager.py   # ターン進行管理（11フェーズ）
├── models/
│   ├── province.py       # 領地モデル
│   ├── daimyo.py         # 大名モデル
│   ├── general.py        # 武将モデル
│   ├── army.py           # 軍隊モデル
│   ├── diplomacy.py      # 外交関係モデル
│   └── event.py          # イベントモデル ✓ NEW
├── systems/
│   ├── economy.py        # 経済システム
│   ├── internal_affairs.py # 内政システム
│   ├── military.py       # 軍事システム
│   ├── combat.py         # 戦闘システム
│   ├── diplomacy.py      # 外交システム
│   ├── ai.py             # AIシステム
│   └── events.py         # イベントシステム ✓ NEW
├── ui/
│   ├── widgets.py        # UIコンポーネント
│   ├── event_dialog.py   # イベント選択ダイアログ ✓ NEW
│   └── event_history_screen.py # イベント履歴画面 ✓ NEW
└── data/
    ├── provinces.json    # 15領地データ
    ├── daimyo.json       # 6大名データ
    ├── generals.json     # 15武将データ
    └── events.json       # 18イベントデータ ✓ NEW
```
